## 文件描述符就绪条件
### 在网络编程中，下列情况下socket可读(可以理解为何时阻塞的读操作会返回)：
- 该套接字接收缓存区中的字节数大于或等于其低水位标记.对这样的套接字执行读操作不会阻塞并将返回一个大于0的值(也就是返回准备好读入的数据)。我们可以使用SO_RCVLOWAT套接字选项设置该套接字的低水位标记。对于TCP和UDP套接字而言,其默认值为1。
- socket通信的对方关闭连接(也就是接收了FIN的TCP连接). 对这样的套接字的读操作将不阻塞并返回0(也就是返回EOF)。
- 该套接字是一个监听套接字且已完成的连接数不为0。
- socket 上有未处理的错误。对这样的套接字的读操作将不阻塞并返回-1(也就是返回一个错误),同时把errno设置成确切的错误条件。这些待处理错误(pending error)也可以通过指定SO_ERROR套接字选项调用getsockopt获取并清除。

### 下列情况下socket可写：
- 该套接字发送缓冲区中的可用空间字节数大于等于套接字发送缓冲区低水位标记的当前大小。这意味着如果我们把这样的套接字设置成非阻塞,写操作将不阻塞并返回一个正值。我们可以使用SO_SNDLOWAT套接字选项来设置该套接字的低水位标记。对于TCP和UDP套接字而言,其默认值通常为2048。
- socket的写操作被关闭。对写操作被关闭的socket执行写操作将触发一个SIGPIPE信号。
- socket使用非阻塞connect连接成功或者失败（超时）之后.
- socket上有未处理的错误.

### 网络程序中，select能处理的异常情况只有一种：socket 上接收到带外数据.

注意:当某个套接字上发生错误时,它将由select标记为既可读又可写。

接收低水位标记和发送低水位标记的目的在于:允许应用进程控制在select返回可读或可写条件之前有多少数据可读或有多大空间可用于写。举例来说,如果我们知道除非至少存在64个字节的数据,否则我们的应用进程没有任何有效工作可做,那么可以把接收低水位标记设置为64,以防少于64个字节的数据准备好读时select唤醒我们。

图6-7汇总了上述导致select返回某个套接字就绪的条件。
![](https://cdn.nlark.com/yuque/0/2022/png/21856657/1653139276640-47a70902-373a-4f23-ba57-43805daa6ba4.png) 

